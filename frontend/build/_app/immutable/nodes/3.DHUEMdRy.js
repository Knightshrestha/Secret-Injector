import{e as $,a as Y,b as ee,c as _e,s as he,d as we}from"../chunks/D9ilNyEn.js";import"../chunks/DsnmJJEf.js";import{d as re,s as k,e as ke,o as Se}from"../chunks/D9Q0S_Q0.js";import{p as ae,W as ve,G as t,c as se,f as Q,e as E,k as oe,X as S,i as B,l as r,r as a,j as o,o as e,Y as je,t as F,m as ce,F as Ee}from"../chunks/DjbzThlV.js";import{p as te,i as H}from"../chunks/BPjjjB19.js";import{r as ue}from"../chunks/CkDF1lTp.js";const De=(async({params:V,fetch:d})=>{if(!V.project_id)throw $(404,{message:"Project ID not provided"});const l=await d(Y(`/projects/${V.project_id}`));if(l.ok){const n=await l.json(),i=await d(Y(`/projects/${n.id}/secrets`));if(i.ok)return{secrets:await i.json(),project:n};throw $(i.status)}else throw $(l.status,await l.json())}),Ue=Object.freeze(Object.defineProperty({__proto__:null,load:De},Symbol.toStringTag,{value:"Module"}));var Me=B('<div class="mb-4 rounded-lg bg-red-50 p-3 text-sm text-red-800"> </div>'),Ce=B('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4" tabindex="0" role="dialog" aria-modal="true" aria-labelledby="modal-title"><div class="w-full max-w-md rounded-lg bg-white shadow-xl"><div class="border-b border-gray-200 px-6 py-4"><h3 id="modal-title" class="text-xl font-bold text-gray-900"> </h3></div> <form class="p-6"><!> <div class="mb-4"><label for="name" class="mb-1 block text-sm font-medium text-gray-700">Secret Key <span class="text-red-500">*</span></label> <input type="text" id="name" class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none" placeholder="Enter secret key" required/></div> <div class="mb-4"><label for="name" class="mb-1 block text-sm font-medium text-gray-700">Secret Value <span class="text-red-500">*</span></label> <input type="text" id="name" class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none" placeholder="Enter secret value" required/></div> <div class="mb-6"><label for="description" class="mb-1 block text-sm font-medium text-gray-700">Description</label> <textarea id="description" rows="3" class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none" placeholder="Enter secret description (optional)"></textarea></div> <div class="flex justify-end gap-3"><button type="button" class="rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50">Cancel</button> <button type="submit" class="rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:bg-blue-400"> </button></div></form></div></div>');function Oe(V,d){ae(d,!0);let l=te(d,"isOpen",15,!1),n=te(d,"secret",3,null),i=S(""),b=S(""),p=S(""),m=S(!1),x=S("");ve(()=>{l()&&(n()?(t(i,n().key,!0),t(b,n().description||"",!0),t(p,n().value||"",!0)):(t(i,""),t(b,""),t(p,"")),t(x,""))});function P(){l(!1),t(x,"")}async function I(f){if(f.preventDefault(),!e(i).trim()){t(x,"Secret Key is required");return}if(!e(p).trim()){t(x,"Secret Value is required");return}t(m,!0),t(x,"");try{const g=n()?Y(`/secrets/${n().id}`):Y("/secrets"),D=n()?"PATCH":"POST",_=await fetch(g,{method:D,headers:{"Content-Type":"application/json"},body:JSON.stringify({project_id:d.projectId,key:e(i).trim(),value:e(p).trim(),description:e(b).trim()||null})});if(!_.ok){const M=await _.json();throw console.log(M),new Error(M.error||"Failed to save secret")}P(),d.onSuccess?.()}catch(g){t(x,g instanceof Error?g.message:"An error occurred",!0)}finally{t(m,!1)}}function c(f){f.target===f.currentTarget&&P()}var y=se(),q=Q(y);{var O=f=>{var g=Ce();g.__click=c,g.__keydown=v=>{v.key==="Enter"||v.key};var D=r(g),_=r(D),M=r(_),A=r(M,!0);a(M),a(_);var T=o(_,2),L=r(T);{var U=v=>{var J=Me(),G=r(J,!0);a(J),F(()=>k(G,e(x))),E(v,J)};H(L,v=>{e(x)&&v(U)})}var C=o(L,2),N=o(r(C),2);ue(N),a(C);var z=o(C,2),K=o(r(z),2);ue(K),a(z);var s=o(z,2),u=o(r(s),2);je(u),a(s);var j=o(s,2),h=r(j);h.__click=P;var w=o(h,2),R=r(w,!0);a(w),a(j),a(T),a(D),a(g),F(()=>{k(A,n()?"Edit Secret":"Create New Secret"),N.disabled=e(m),K.disabled=e(m),u.disabled=e(m),h.disabled=e(m),w.disabled=e(m),k(R,e(m)?"Saving...":n()?"Update":"Create")}),ke("submit",T,I),ee(N,()=>e(i),v=>t(i,v)),ee(K,()=>e(p),v=>t(p,v)),ee(u,()=>e(b),v=>t(b,v)),E(f,g)};H(q,f=>{l()&&f(O)})}E(V,y),oe()}re(["click","keydown"]);var Te=B('<div class="mb-4 rounded-lg bg-red-50 p-3 text-sm text-red-800"> </div>'),Le=B('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4" role="dialog" aria-modal="true" aria-labelledby="modal-title" tabindex="0"><div class="w-full max-w-md rounded-lg bg-white shadow-xl"><div class="border-b border-gray-200 px-6 py-4"><h3 id="modal-title" class="text-xl font-bold text-gray-900">Delete Secret</h3></div> <div class="p-6"><!> <p class="mb-2 text-gray-700">Are you sure you want to delete <strong> </strong>?</p> <p class="text-sm text-gray-500">This action cannot be undone. This will also delete all associated secrets.</p></div> <div class="flex justify-end gap-3 border-t border-gray-200 px-6 py-4"><button type="button" class="rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50">Cancel</button> <button type="button" class="rounded-lg bg-red-600 px-4 py-2 text-sm font-medium text-white hover:bg-red-700 disabled:bg-red-400"> </button></div></div></div>');function Ne(V,d){ae(d,!0);let l=te(d,"isOpen",15,!1),n=S(!1),i=S("");ve(()=>{l()&&t(i,"")});function b(){l(!1),t(i,"")}async function p(){if(d.secret){t(n,!0),t(i,"");try{const c=await fetch(Y(`/secrets/${d.secret.id}`),{method:"DELETE"});if(!c.ok){const y=await c.json();throw new Error(y.message||"Failed to delete secret")}b(),d.onSuccess?.()}catch(c){t(i,c instanceof Error?c.message:"An error occurred",!0)}finally{t(n,!1)}}}function m(c){c.target===c.currentTarget&&b()}var x=se(),P=Q(x);{var I=c=>{var y=Le();y.__click=m,y.__keydown=C=>{};var q=r(y),O=o(r(q),2),f=r(O);{var g=C=>{var N=Te(),z=r(N,!0);a(N),F(()=>k(z,e(i))),E(C,N)};H(f,C=>{e(i)&&C(g)})}var D=o(f,2),_=o(r(D)),M=r(_,!0);a(_),ce(),a(D),ce(2),a(O);var A=o(O,2),T=r(A);T.__click=b;var L=o(T,2);L.__click=p;var U=r(L,!0);a(L),a(A),a(q),a(y),F(()=>{k(M,d.secret.key),T.disabled=e(n),L.disabled=e(n),k(U,e(n)?"Deleting...":"Delete")}),E(c,y)};H(P,c=>{l()&&d.secret&&c(I)})}E(V,x),oe()}re(["click","keydown"]);var Ve=B('<div class="rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 py-12 text-center"><svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg> <p class="mt-2 text-lg text-gray-500">No secrets yet</p> <p class="mt-1 text-sm text-gray-400">Create your first secret to get started</p></div>'),qe=B('<p class="text-sm text-gray-600"> </p>'),ze=B('<div class="group rounded-xl border border-gray-100 bg-white p-6 shadow-sm transition-all hover:shadow-md"><div class="mb-3 flex items-start justify-between"><div class="flex-1"><h3 class="mb-1 text-xl font-bold text-gray-900"> </h3> <!></div> <div class="flex gap-2 opacity-0 transition-opacity group-hover:opacity-100"><button class="text-sm font-medium text-blue-600 hover:text-blue-800">Edit</button> <button class="text-sm font-medium text-red-600 hover:text-red-800">Delete</button></div></div> <div class="flex items-center gap-6 border-t border-gray-100 pt-3 text-xs text-gray-500"><span class="flex items-center gap-1"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> </span> <span class="flex items-center gap-1"><svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> </span></div></div>'),Be=B('<div class="flex flex-col gap-4 p-4"><div class="flex items-center justify-between"><h2 class="text-2xl font-bold text-gray-900"> </h2> <div class="flex items-center gap-4"><div class="flex items-center gap-2 text-xs"><span></span> <span class="text-gray-600"> </span></div> <button class="rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700">+ New Secret</button></div></div> <!></div> <!> <!>',1);function Ke(V,d){ae(d,!0);let l=S(Ee(d.data.secrets||[])),n=S(!1),i=S(!1),b=S(!1),p=S(null);Se(()=>{const s=new EventSource(_e("/secrets"));return s.onopen=()=>{console.log("Secret SSE connected"),t(n,!0)},s.addEventListener("create",u=>{const j=JSON.parse(u.data);t(l,[...e(l),j.data],!0)}),s.addEventListener("update",u=>{const j=JSON.parse(u.data);t(l,e(l).map(h=>h.id===j.data.id?j.data:h),!0)}),s.addEventListener("delete",u=>{const j=JSON.parse(u.data);t(l,e(l).filter(h=>h.id!==j.data.id),!0)}),s.addEventListener("ping",()=>{}),s.onerror=u=>{console.error("Secret SSE error:",u),t(n,!1)},()=>{s.close(),t(n,!1)}});function m(s){return new Date(s).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function x(){t(p,null),t(i,!0)}function P(s){t(p,s,!0),t(i,!0)}function I(s){t(p,s,!0),t(b,!0)}function c(){t(p,null)}var y=Be(),q=Q(y),O=r(q),f=r(O),g=r(f);a(f);var D=o(f,2),_=r(D),M=r(_),A=o(M,2),T=r(A,!0);a(A),a(_);var L=o(_,2);L.__click=x,a(D),a(O);var U=o(O,2);{var C=s=>{var u=Ve();E(s,u)},N=s=>{var u=se(),j=Q(u);we(j,17,()=>e(l),h=>h.id,(h,w)=>{var R=ze(),v=r(R),J=r(v),G=r(J),pe=r(G);a(G);var fe=o(G,2);{var be=W=>{var X=qe(),ye=r(X,!0);a(X),F(()=>k(ye,e(w).description)),E(W,X)};H(fe,W=>{e(w).description&&W(be)})}a(J);var ne=o(J,2),ie=r(ne);ie.__click=()=>P(e(w));var ge=o(ie,2);ge.__click=()=>I(e(w)),a(ne),a(v);var de=o(v,2),Z=r(de),me=o(r(Z));a(Z);var le=o(Z,2),xe=o(r(le));a(le),a(de),a(R),F((W,X)=>{k(pe,`${e(w).key??""}: ${e(w).value??""}`),k(me,` Created ${W??""}`),k(xe,` Updated ${X??""}`)},[()=>m(e(w).created_at),()=>m(e(w).updated_at)]),E(h,R)}),E(s,u)};H(U,s=>{e(l).length===0?s(C):s(N,!1)})}a(q);var z=o(q,2);Oe(z,{get projectId(){return d.data.project.id},get secret(){return e(p)},onSuccess:c,get isOpen(){return e(i)},set isOpen(s){t(i,s,!0)}});var K=o(z,2);Ne(K,{get secret(){return e(p)},onSuccess:c,get isOpen(){return e(b)},set isOpen(s){t(b,s,!0)}}),F(()=>{k(g,`Project: ${d.data.project.name??""}`),he(M,1,`h-2 w-2 rounded-full ${e(n)?"bg-green-500":"bg-gray-400"} 
					${e(n)?"animate-pulse":""}`),k(T,e(n)?"Live":"Disconnected")}),E(V,y),oe()}re(["click"]);export{Ke as component,Ue as universal};
